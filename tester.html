<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>testing</title>
    <style media="screen">

    </style>
  </head>
  <body>
    <div id="map"></div>
    <p>
      Testing the soursing in of foursquare and google data and presenting it in tandum(google places and foursquare)
    </p>
    <script type="text/javascript">
    //going to change things up here... now I am only going to get the location from foursquare, enter taht latlng into Google Places and gen
    //a static image using the geometry library
      function foursquareLatLngs(data, arr){
        var leastLength = data.response.venues.length <  5? data.response.venues.length : 5;
        var viewer = new google.maps.StreetViewService();
        for (var i = 0; i < leastLength; i++) {
          obj = {};
          obj.latlng = {};
          obj.latlng.lat = data.response.venues[i].location.lat;
          obj.latlng.lng = data.response.venues[i].location.lng;
          arr.push(obj);
          viewer.getPanorama({location: obj.latlng,radius: 50},
             (function(container){
               var tbr = function(data){
                 container.img = data;
                 var img = document.createElement('img');
                 document.body.appendChild(img);
                var pano = new google.maps.StreetViewPanorama(
                   img, {
                     position: container.latlng,
                     pov: {
                       heading: 23,
                       pitch: 10
                     }
                   }
                 );
                 map.setStreetView(pano);
               };
               return tbr;
             })(obj));
        }
        console.log(arr);
      }

      function streetViews(arr) {
        //pop pop

      }

      function foursquareCallback(data) {
        var objs = [];
        foursquareLatLngs(data, objs);
        //next up is getting street view images
        streetViews(objs);
      }


      function displayIceCream() {
        //setting global
        map = new google.maps.Map(document.getElementById('map'),{
          center: {lat: 39.7392,lng: 104.9903},
          zoom: 15
        })
        function grabIceCream() {
          //create a jsonp
          var jsonpTag = document.createElement('script');
          jsonpTag.src = 'https://api.foursquare.com/v2/venues/search'
          + '?client_id=YKHATSNI4PS0K4TQXIXNWD12B4YCUTDLJC3ECIQMJ5QQTBNK'
          + '&client_secret=DAB2LCKMTADFEDKXBCISFZD31OC5YFQK3GUZ5MAFOWJOA3H4'
          + '&v=20130815'
          + '&near=Denver,CO'
          + '&query=Ice+Cream'
          + '&callback=foursquareCallback';
          document.getElementsByTagName('head')[0].appendChild(jsonpTag);
        }
        grabIceCream();
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwYxt2NExnl2hBlsMgZrOb8-pkm3y6jeA&libraries=places,geometry&callback=displayIceCream" async defer></script>
  </body>
</html>
